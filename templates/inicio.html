{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Inicio - CESFAM</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js'></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="{% static 'style.css' %}">
    
</head>
<body>
    <header>
        <h2 class="logo-title">
            CESFAM
            <img src="{% static 'img/logoin.png' %}" alt="Logo" class="logo-navbar-small">
        </h2>
        <div class="header-user-info">
            <img src="https://via.placeholder.com/40" alt="Foto" class="rounded-circle">
            <span class="ml-2">Hola, {{ user.get_full_name|default:user.username }}</span>
            <a href="{% url 'login' %}" class="text-white ml-3 small">(Salir)</a>
        </div>
    </header>
    {% block content %}
    <div class="main-container">
        <div class="left-section">
            <div class="calendar">
                <h3>Calendario del mes</h3>
                <div id='calendar'></div>
            </div>
            <a href="{% url 'anuncios' %}">
                <div class="announcement-box">
                    <h4>üì¢ Anuncios</h4>
                    <p>Ver √∫ltimas noticias institucionales.</p>
                </div>
            </a>
        </div>

        <div class="right-section">
            
            <div class="user-info">
                <img src="https://via.placeholder.com/100" alt="Perfil" class="user-info-profile-pic">
                <h3>{{ user.get_full_name|default:user.username }}</h3>
                <p class="text-muted">{{ user.perfil.area.nombre|default:"Sin √Årea Asignada" }}</p>
    
                <div class="day-section mt-3 text-left pl-4">
                    <h5 class="mb-3">D√≠as Administrativos Usados ({{ anio_actual }}): 
                        <strong class="text-primary">{{ dias_usados }}</strong></h5>
                    <h5>Vacaciones: 
                        {% if estado_vacaciones == 'Esperando' %}
                        <span class="badge badge-warning text-white">Esperando</span>
                        {% elif estado_vacaciones == 'Aprobado' %}
                        <span class="badge badge-success">Aprobado</span>
                        {% elif estado_vacaciones == 'Rechazado' %}
                        <span class="badge badge-danger">Rechazado</span>
                        {% else %}
                        <span class="badge badge-secondary">--</span>
                        {% endif %}
                    </h5>
                </div>
            </div>

            {% if user.groups.all.0.name == 'Direccion' or user.groups.all.0.name == 'Subdireccion Administrativa' or user.groups.all.0.name == 'Subdireccion Clinica' %}
            <div class="admin-panel-box">
                <h5 class="text-info">üõ† Panel de Direcci√≥n</h5>
                <p class="small">Acceso total al sistema.</p>
                
                <a href="{% url 'lista_funcionarios' %}" class="btn btn-info btn-block mb-2">
                    üë• Gestion
                </a>
            </div>
            {% endif %}

            {% if user.groups.all.0.name == 'Jefatura' %}
            <div class="jefatura-panel-box">
                <h5 class="text-success">üìã Panel de Jefatura</h5>
                <p class="small">Gesti√≥n de tu √°rea: <strong>{{ user.perfil.area.nombre }}</strong></p>
                
                <a href="{% url 'revisar_solicitudes' %}" class="btn btn-success btn-block mb-2">
                    ‚úÖ Aprobar D√≠as Libres (Mi √Årea)
                </a>
                <a href="{% url 'revisar_solicitudes_vacaciones' %}" class="btn btn-outline-success btn-block btn-sm">
                    ‚úàÔ∏è Aprobar Vacaciones
                </a>
            </div>
            {% endif %}

            {% if not user.is_superuser %}
            <a href="{% url 'crear_solicitud' %}">
                <div class="report-box">
                    <h4>üìù Solicitar D√≠a Libre</h4>
                    <p>Pide un d√≠a administrativo o feriado legal.</p>
                </div>
            </a>
            {% endif %}

            <a href="{% url 'avisos' %}">
                <div class="report-box">
                    <h4>‚ö†Ô∏è Reportar Problema</h4>
                    <p>Infraestructura, limpieza, etc.</p>
                </div>
            </a>

            <a href="{% url 'lista_documentos' %}">
                <div class="report-box">
                    <h4>üìÇ Documentos</h4>
                    <p>Reglamentos y archivos.</p>
                </div>
            </a>

        </div> 
    </div> 
    {% endblock %}
    <footer class="text-center mt-5 mb-3">
        <hr style="width: 80%; opacity: 0.3;">
        <p class="text-muted small">
            Intranet CESFAM Santa Rosa <br>
            <span class="badge badge-secondary">Versi√≥n 0.8 (Beta)</span> 
            <span class="ml-2">¬© 2025 Desarrollo Interno</span>
        </p>
    </footer>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            headerToolbar: {
                left: 'prev,next today',
                center: 'title',
                right: 'dayGridMonth,timeGridWeek,timeGridDay' 
            },
            events: '/api/eventos/',
            locale: 'es',
            buttonText: {
                today: 'Hoy',
                month: 'Mes',
                week: 'Semana',
                day: 'D√≠a'
            }
        });
        calendar.render();
    });
    </script>
</body>
</html>